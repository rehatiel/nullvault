{% extends "base.njk" %}

{% block head %}
<script defer src="/secret.js"></script>
{% endblock %}

{% block content %}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEMPLATE HEADERS â€” branding shown above the card content
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}

{% if template == 'banking' %}
<div class="tpl-banking-header">
  <div class="tpl-banking-logo">ğŸ¦ SecureBank</div>
  <div class="tpl-banking-sub">Secure Document Portal</div>
</div>

{% elif template == 'crypto' %}
<div class="tpl-crypto-header">
  <div class="tpl-crypto-logo">â‚¿ CryptoVault</div>
  <div class="tpl-crypto-sub">Encrypted Key Delivery</div>
</div>

{% elif template == 'invoice' %}
<div class="tpl-invoice-header">
  <div class="tpl-invoice-logo">ğŸ“„ DocuSend</div>
  <div class="tpl-invoice-sub">Secure Invoice &amp; Document Delivery</div>
</div>

{% elif template == 'corporate' %}
<div class="tpl-corporate-header">
  <div class="tpl-corporate-logo">ğŸ¢ CorpDocs</div>
  <div class="tpl-corporate-sub">Internal Document Distribution System</div>
</div>

{% elif template == 'docs' %}
<div class="tpl-docs-header">
  <div class="tpl-docs-logo">ğŸ“‚ ShareDrive</div>
  <div class="tpl-docs-sub">Shared Document Viewer</div>
</div>
{% endif %}


{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE: AVAILABLE â€” show the reveal button
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% if state == 'available' %}

  {% if template == 'invoice' %}
    <div class="secret-header">
      <h1>You have a document ready</h1>
      <p>An invoice or document has been sent to you via DocuSend's encrypted delivery system. Click below to view it â€” this link is single-use.</p>
    </div>
    <div class="tpl-meta-row">
      <span class="tpl-meta-pill">ğŸ“ Document type: Confidential</span>
      <span class="tpl-meta-pill">ğŸ” Encrypted delivery</span>
      <span class="tpl-meta-pill">â± Expires after one view</span>
    </div>

  {% elif template == 'corporate' %}
    <div class="secret-header">
      <h1>Confidential document shared with you</h1>
      <p>A colleague has shared a restricted document via CorpDocs. Access is logged. This document is available for a single viewing.</p>
    </div>
    <div class="tpl-meta-row">
      <span class="tpl-meta-pill">ğŸ”’ Access-controlled</span>
      <span class="tpl-meta-pill">ğŸ“‹ Audit logged</span>
      <span class="tpl-meta-pill">ğŸ’¼ Internal use only</span>
    </div>

  {% elif template == 'docs' %}
    <div class="secret-header">
      <h1>A document has been shared with you</h1>
      <p>Someone shared a file via ShareDrive. Click to view its contents â€” the file will be removed from this link after access.</p>
    </div>
    <div class="tpl-meta-row">
      <span class="tpl-meta-pill">ğŸ“‚ Read-only access</span>
      <span class="tpl-meta-pill">ğŸ”— Single-use link</span>
    </div>

  {% elif template == 'banking' %}
    <div class="secret-header">
      <h1>Secure document ready for access</h1>
      <p>A document has been shared with you through SecureBank's encrypted portal. This link is valid for one access only.</p>
    </div>

  {% elif template == 'crypto' %}
    <div class="secret-header">
      <h1>Your encrypted key is ready</h1>
      <p>A wallet recovery phrase or private key has been securely stored here. Click below to reveal it â€” this action is irreversible.</p>
    </div>

  {% else %}
    <div class="secret-header">
      <h1>You've received a secret</h1>
      <p>Click the button below to reveal the secret content.</p>
    </div>
  {% endif %}

  <div id="revealError" class="warn-box hidden" style="margin-bottom:1rem"></div>
  <button id="revealBtn" class="btn btn-primary reveal-btn" data-token="{{ token }}">
    {% if template == 'invoice' %}ğŸ“„ &nbsp;View Document
    {% elif template == 'corporate' %}ğŸ“‹ &nbsp;Open Document
    {% elif template == 'docs' %}ğŸ“‚ &nbsp;View File
    {% elif template == 'banking' %}ğŸ” &nbsp;Access Document
    {% elif template == 'crypto' %}ğŸ”‘ &nbsp;Reveal Key
    {% else %}ğŸ”“ &nbsp;Reveal Secret
    {% endif %}
  </button>

  {# Expiry countdown â€” only rendered when expires_at is set #}
  {% if expiresAt %}
  <div class="expiry-countdown" id="expiryCountdown" data-expires="{{ expiresAt }}">
    <span class="expiry-icon">â³</span>
    <span class="expiry-label">This link expires in</span>
    <span class="expiry-timer" id="expiryTimer">â€¦</span>
  </div>
  {% endif %}


{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE: REVEALED â€” show the content
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% elif state == 'revealed' %}

  <div class="secret-header">
    {% if template == 'invoice' %}<h1>ğŸ“„ Document Contents</h1>
    {% elif template == 'corporate' %}<h1>ğŸ“‹ Document Opened</h1>
    {% elif template == 'docs' %}<h1>ğŸ“‚ File Contents</h1>
    {% else %}<h1>ğŸ”“ Secret Revealed</h1>
    {% endif %}
    {% if burnsOnReveal %}
    <p>This content has now been permanently removed. It cannot be accessed again.</p>
    {% else %}
    <p>The content is shown below.</p>
    {% endif %}
  </div>

  <div class="reveal-box">
    <div class="reveal-label">
      {% if template == 'invoice' %}Document Contents
      {% elif template == 'corporate' %}Confidential Contents
      {% elif template == 'docs' %}File Contents
      {% elif template == 'crypto' %}Wallet Key / Recovery Phrase
      {% else %}Secret Content
      {% endif %}
    </div>
    <div class="reveal-content" id="secretContent">{{ content }}</div>
    <button class="copy-btn" id="copyBtn">Copy</button>
  </div>

  {% if burnsOnReveal %}
  <div class="warn-box">
    âš ï¸ Save this information now. This page will not show it again if you refresh.
  </div>
  {% endif %}


{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE: LOCATION REQUIRED
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% elif state == 'location_required' %}

  <div class="secret-header">
    {% if template == 'banking' %}<h1>Identity Verification Required</h1>
    {% elif template == 'crypto' %}<h1>Wallet Access Restricted</h1>
    {% elif template == 'invoice' %}<h1>Secure Access Required</h1>
    {% elif template == 'corporate' %}<h1>Access Policy Not Met</h1>
    {% elif template == 'docs' %}<h1>Verification Required</h1>
    {% else %}<h1>Location Verification Required</h1>
    {% endif %}
    <p>
      {% if template == 'banking' %}
        This document requires identity verification via your registered mobile device. Please open this link on your mobile phone with location services enabled.
      {% elif template == 'crypto' %}
        For security, wallet access is restricted to verified mobile devices with location services active. Please retry on your mobile device.
      {% elif template == 'invoice' %}
        Secure document delivery requires location verification. Please open this link on a mobile device with location services enabled.
      {% elif template == 'corporate' %}
        Your organisation's access policy requires location verification on a mobile device. Please open this link on your work phone.
      {% elif template == 'docs' %}
        File access requires location verification. Please open this link on a mobile device with location services enabled.
      {% else %}
        This secret requires location verification to access. Please open this link on a mobile device and allow location access when prompted.
      {% endif %}
    </p>
  </div>

  <div class="warn-box">
    ğŸ“± To access this content, open this link on a <strong>mobile device</strong> and ensure location services are enabled for your browser.
  </div>

  <div class="qr-prompt">
    <p class="qr-prompt-label">Scan with your phone to continue</p>
    <img class="qr-prompt-img" src="/s/{{ token }}/qr" alt="QR code to open this link on your mobile device" width="180" height="180" />
  </div>

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE: BURNED / UNAVAILABLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% else %}

  <div class="secret-header">
    {% if template == 'invoice' %}<h1>Document no longer available</h1>
    {% elif template == 'corporate' %}<h1>Document access expired</h1>
    {% elif template == 'docs' %}<h1>File no longer available</h1>
    {% else %}<h1>Secret Unavailable</h1>
    {% endif %}
    <p>This
      {% if template in ['invoice','corporate','docs'] %}document{% else %}secret{% endif %}
      has already been viewed, has expired, or does not exist.
    </p>
  </div>

  <div class="warn-box">
    âš ï¸ Each link can only be used once. If you believe this is an error, contact the person who sent you this link.
  </div>

  <a href="/" class="btn btn-secondary">Create Your Own Secret</a>

{% endif %}

{% endblock %}
