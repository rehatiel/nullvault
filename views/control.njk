<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>{{ siteName }} ‚Äî Control Panel</title>
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="/control-panel.css" />
  <script src="/chart.min.js"></script>
  <script defer src="/control.js"></script>
</head>
<body class="cp-body" data-ua-list="{{ logs | dump | escape }}">

  {# ‚îÄ‚îÄ Header ‚îÄ‚îÄ #}
  <header class="cp-header">
    <div class="cp-header-left">
      <a class="cp-logo" href="/">{{ siteLogo }} {{ siteName }}</a>
      <span class="cp-divider">/</span>
      <span class="cp-title">Control Panel</span>
    </div>
    <div class="cp-header-right">
      <button class="cp-print-btn" id="printBtn" title="Print / save report">üñ® Print</button>
      {% if burned %}
        <span class="cp-status cp-status-burned">‚óè Burned</span>
      {% elif expired %}
        <span class="cp-status cp-status-expired">‚óè Expired</span>
      {% else %}
        <span class="cp-status cp-status-active">‚óè Active</span>
      {% endif %}
    </div>
  </header>

  {# ‚îÄ‚îÄ Meta bar ‚îÄ‚îÄ #}
  <div class="cp-meta-bar">
    <div class="cp-meta-left">
      <span class="cp-meta-item">Created <strong>{{ secret.created_at | datetime }}</strong></span>
      {% if secret.expires_at %}<span class="cp-meta-sep">¬∑</span><span class="cp-meta-item">Expires <strong>{{ secret.expires_at | datetime }}</strong></span>{% endif %}
      <span class="cp-meta-sep">¬∑</span>
      <span class="cp-meta-item">Logs kept <strong>{{ retentionDays }}d</strong></span>
      <span class="cp-meta-sep">¬∑</span>
      {% if secret.burn_on_reveal %}
        <span class="cp-meta-item">üî• <strong>Burns on reveal</strong></span>
      {% else %}
        <span class="cp-meta-item">‚ôªÔ∏è <strong>Persistent</strong></span>
      {% endif %}
      {# Note/label ‚Äî shown inline if set, dimmed placeholder if not #}
      {% if note %}
        <span class="cp-meta-sep">¬∑</span>
        <span class="cp-meta-item cp-meta-note" id="metaNoteDisplay" title="Your label for this link">üìù {{ note }}</span>
      {% endif %}
    </div>
    <div class="cp-url-row">
      <span class="cp-url-text" id="pubUrl">{{ publicUrl }}</span>
      <button class="cp-copy-btn" id="copyUrlBtn">Copy Link</button>
    </div>
  </div>

  {# ‚îÄ‚îÄ Stat cards ‚îÄ‚îÄ #}
  <div class="cp-stats">
    <div class="cp-stat">
      <div class="cp-stat-value">{{ stats.totalViews }}</div>
      <div class="cp-stat-label">Total Views</div>
    </div>
    <div class="cp-stat {% if stats.revealAttempts > 0 %}cp-stat-warn{% endif %}">
      <div class="cp-stat-value">{{ stats.revealAttempts }}</div>
      <div class="cp-stat-label">Reveal Attempts</div>
    </div>
    <div class="cp-stat {% if stats.revealSuccesses > 0 %}cp-stat-danger{% endif %}">
      <div class="cp-stat-value">{{ stats.revealSuccesses }}</div>
      <div class="cp-stat-label">Successful Reveals</div>
    </div>
    <div class="cp-stat cp-stat-accent">
      <div class="cp-stat-value">{{ stats.uniqueIPs }}</div>
      <div class="cp-stat-label">Unique IPs</div>
    </div>
  </div>

  {# ‚îÄ‚îÄ Tab nav ‚îÄ‚îÄ #}
  <nav class="cp-tabs">
    <button class="cp-tab active" id="nav-overview">Overview</button>
    <button class="cp-tab" id="nav-timeline">Timeline</button>
    <button class="cp-tab" id="nav-devices">Devices</button>
    <button class="cp-tab" id="nav-ips">IP Addresses</button>
    <button class="cp-tab" id="nav-analysis">Analysis</button>
    <button class="cp-tab" id="nav-logs">Raw Logs</button>
    <button class="cp-tab" id="nav-track">Track</button>
    <button class="cp-tab" id="nav-settings">Settings</button>
  </nav>

  {# ‚îÄ‚îÄ IP masking toolbar ‚îÄ‚îÄ #}
  <div class="cp-ip-mask-bar no-print">
    <span class="cp-ip-mask-label">IP display:</span>
    <button class="cp-ip-mask-btn cp-ip-mask-btn-active" id="maskIpsBtn">Masked</button>
    <button class="cp-ip-mask-btn" id="revealIpsBtn">Full</button>
    <span class="cp-ip-mask-note">Masking hides the last octet for screenshots and educational use. Stored data is unchanged.</span>
  </div>

  {# ‚îÄ‚îÄ Tab content ‚îÄ‚îÄ #}
  <div class="cp-content">

    {# ‚ïê‚ïê OVERVIEW ‚ïê‚ïê #}
    <div id="tab-overview" class="cp-panel active">

      {% if logs | length == 0 %}
        <div class="cp-empty">No activity recorded yet. Share your public link to start tracking access.</div>
      {% else %}

        {# Activity Chart #}
        <div class="cp-section-title">Activity Over Time</div>
        <div class="cp-chart-wrap">
          <canvas id="activityChart" height="120"></canvas>
        </div>

        {# Event breakdown #}
        <div class="cp-overview-row">
          <div class="cp-overview-col">
            <div class="cp-section-title">Event Breakdown</div>
            <div class="cp-chart-wrap cp-chart-small">
              <canvas id="eventChart"></canvas>
            </div>
          </div>
          <div class="cp-overview-col">
            <div class="cp-section-title">Top Locations</div>
            <div id="locationList" class="cp-device-list"></div>
          </div>
        </div>

        {# World Map #}
        <div class="cp-section-title cp-section-title-gap">Access Map</div>
        <div id="worldMap" class="cp-map-wrap"></div>

        {# US state map ‚Äî shown when US traffic detected #}
        <div id="usMapSection" hidden>
          <div class="cp-section-title cp-section-title-gap">United States ‚Äî State Breakdown</div>
          <div id="usMap" class="cp-map-wrap cp-map-wrap--us"></div>
        </div>

        {# Recent activity #}
        <div class="cp-section-title cp-section-title-gap">Recent Activity</div>
        <div class="cp-timeline">
          {% for log in logs | slice(0, 10) %}
          <div class="cp-tl-row">
            <div class="cp-tl-dot {% if log.reveal_succeeded %}cp-dot-reveal{% elif log.reveal_attempted %}cp-dot-attempt{% else %}cp-dot-view{% endif %}"></div>
            <div class="cp-tl-body">
              <div class="cp-tl-event">
                {% if log.reveal_succeeded %}Secret Revealed
                {% elif log.reveal_attempted %}Reveal Attempted (failed)
                {% else %}Page Viewed
                {% endif %}
                {% if log._labels %}
                  {% for lbl in log._labels %}
                    <span class="cp-evtlabel cp-evtlabel-{{ lbl | replace('_', '-') }}">{{ lbl | replace('_', ' ') }}</span>
                  {% endfor %}
                {% endif %}
              </div>
              <div class="cp-tl-meta">
                <span class="cp-ip-val" data-ip="{{ log.ip_address or '' }}">{{ log.ip_address or 'Unknown IP' }}</span>
                {% if log.location %}<span>{{ log.location }}</span>{% endif %}
                {% if log.timezone %}<span class="cp-tl-tz">{{ log.timezone }}</span>{% endif %}
                {% if log.org %}<span>{{ log.org }}</span>{% endif %}
                {% if log.accept_language %}<span class="cp-tl-lang" title="Accept-Language">üåê {{ log.accept_language | truncate(30) }}</span>{% endif %}
              </div>
            </div>
            <div class="cp-tl-time" data-ts="{{ log.accessed_at }}" title="{{ log.accessed_at | datetime }}">{{ log.accessed_at | datetime }}</div>
          </div>
          {% endfor %}
        </div>

      {% endif %}
    </div>

    {# ‚ïê‚ïê TIMELINE ‚ïê‚ïê #}
    <div id="tab-timeline" class="cp-panel">
      <div class="cp-section-title">Full Access Timeline</div>
      {% if logs | length == 0 %}
        <div class="cp-empty">No activity recorded yet.</div>
      {% else %}
        <div class="cp-timeline">
          {% for log in logs %}
          <div class="cp-tl-row">
            <div class="cp-tl-dot {% if log.reveal_succeeded %}cp-dot-reveal{% elif log.reveal_attempted %}cp-dot-attempt{% else %}cp-dot-view{% endif %}"></div>
            <div class="cp-tl-body">
              <div class="cp-tl-event">
                {% if log.reveal_succeeded %}Secret Revealed
                {% elif log.reveal_attempted %}Reveal Attempted (failed)
                {% else %}Page Viewed
                {% endif %}
                {% if log._labels %}
                  {% for lbl in log._labels %}
                    <span class="cp-evtlabel cp-evtlabel-{{ lbl | replace('_', '-') }}">{{ lbl | replace('_', ' ') }}</span>
                  {% endfor %}
                {% endif %}
              </div>
              <div class="cp-tl-meta">
                <span class="cp-ip-val" data-ip="{{ log.ip_address or '' }}">{{ log.ip_address or 'Unknown IP' }}</span>
                {% if log.location %}<span>{{ log.location }}</span>{% endif %}
                {% if log.gps_lat %}<a class="cp-gps-link" href="https://maps.google.com/?q={{ log.gps_lat }},{{ log.gps_lng }}" target="_blank" rel="noopener noreferrer" title="Precise GPS location">üìç {{ log.gps_lat | round(4) }}, {{ log.gps_lng | round(4) }}</a>{% endif %}
                {% if log.timezone %}<span class="cp-tl-tz">{{ log.timezone }}</span>{% endif %}
                {% if log.org %}<span>{{ log.org }}</span>{% endif %}
                {% if log.accept_language %}<span class="cp-tl-lang" title="Accept-Language">üåê {{ log.accept_language | truncate(30) }}</span>{% endif %}
                {% if log.sec_fetch_site %}<span class="cp-tl-fetch cp-fetch-{{ log.sec_fetch_site }}">{{ log.sec_fetch_site }}</span>{% endif %}
                {% if log.referer %}<span>ref: {{ log.referer | truncate(50) }}</span>{% endif %}
              </div>
            </div>
            <div class="cp-tl-time" data-ts="{{ log.accessed_at }}" title="{{ log.accessed_at | datetime }}">{{ log.accessed_at | datetime }}</div>
          </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {# ‚ïê‚ïê DEVICES ‚ïê‚ïê #}
    <div id="tab-devices" class="cp-panel">
      <div class="cp-section-title">Device Breakdown</div>
      <p class="cp-hint">Parsed from {{ stats.totalViews }} User-Agent string(s). Where available, Client Hints (Sec-CH-UA) provide more reliable browser/OS data than UA string parsing.</p>
      <div class="cp-device-grid">
        <div class="cp-device-col">
          <div class="cp-device-heading">Browsers</div>
          <div id="browserList" class="cp-device-list"></div>
        </div>
        <div class="cp-device-col">
          <div class="cp-device-heading">Platforms</div>
          <div id="platformList" class="cp-device-list"></div>
        </div>
      </div>

      {% if logs | length > 0 %}

      {# Client Hints section ‚Äî only shown when at least one row has sec_ch_ua #}
      {% set hasClientHints = false %}
      {% for log in logs %}{% if log.sec_ch_ua %}{% set hasClientHints = true %}{% endif %}{% endfor %}

      {% if hasClientHints %}
      <div class="cp-section-title cp-section-title-gap">Client Hints (Sec-CH-UA)</div>
      <p class="cp-hint">Chromium-based browsers send these automatically. More reliable than User-Agent strings for identifying the browser brand and version.</p>
      <div class="cp-ua-list">
        {% for log in logs %}
          {% if log.sec_ch_ua %}
            <div class="cp-ua-row cp-ua-row-ch">
              <span class="cp-ua-ch-badge">CH</span>{{ log.sec_ch_ua }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
      {% endif %}

      <div class="cp-section-title cp-section-title-gap">Raw User-Agent Strings</div>
      <div class="cp-ua-list">
        {% for log in logs %}
          {% if log.user_agent %}
            <div class="cp-ua-row">{{ log.user_agent }}</div>
          {% endif %}
        {% endfor %}
      </div>
      {% endif %}
    </div>

    {# ‚ïê‚ïê IPS ‚ïê‚ïê #}
    <div id="tab-ips" class="cp-panel">
      <div class="cp-section-title">Unique IP Addresses</div>
      <p class="cp-hint cp-hint-warn">
        ‚ÑπÔ∏è Network type and all OSINT links are provided for investigative reference. Lookups open third-party sites in a new tab ‚Äî {{ siteName }} does not share any data with them. Network type labels are heuristic estimates only.
      </p>
      {% if uniqueIPLogs | length == 0 %}
        <div class="cp-empty">No IP data available.</div>
      {% else %}
        <div class="cp-ip-grid">
          {% for log in uniqueIPLogs %}
          <div class="cp-ip-card">
            <div class="cp-ip-addr cp-ip-val" data-ip="{{ log.ip_address }}">{{ log.ip_address }}</div>
            <div class="cp-ip-details">
              {% if log.location %}<div class="cp-ip-row"><span class="cp-ip-label">Location</span><span>{{ log.location }}</span></div>{% endif %}
              {% if log.timezone %}<div class="cp-ip-row"><span class="cp-ip-label">Timezone</span><span>{{ log.timezone }}</span></div>{% endif %}
              {% if log.org %}<div class="cp-ip-row"><span class="cp-ip-label">Org / ISP</span><span>{{ log.org }}</span></div>{% endif %}
              <div class="cp-ip-row">
                <span class="cp-ip-label">Est. network</span>
                <span class="cp-nettype cp-nettype-{{ log._networkType | lower | replace(' ', '-') | replace('/', '-') }}">{{ log._networkType }}</span>
              </div>
              {% if log.accept_language %}<div class="cp-ip-row"><span class="cp-ip-label">Language</span><span class="cp-ip-lang">{{ log.accept_language }}</span></div>{% endif %}
              {% if log.sec_ch_ua %}<div class="cp-ip-row"><span class="cp-ip-label">Client Hints</span><span class="cp-ip-ch">{{ log.sec_ch_ua | truncate(80) }}</span></div>{% endif %}
              <div class="cp-ip-row"><span class="cp-ip-label">First seen</span><span>{{ log.accessed_at | datetime }}</span></div>
            </div>
            {# OSINT quick-lookup links #}
            <div class="cp-osint-links">
              <span class="cp-osint-label">OSINT lookups:</span>
              <a class="cp-osint-link" href="https://www.abuseipdb.com/check/{{ log.ip_address }}" target="_blank" rel="noopener noreferrer">AbuseIPDB</a>
              <a class="cp-osint-link" href="https://scamalytics.com/ip/{{ log.ip_address }}" target="_blank" rel="noopener noreferrer">Scamalytics</a>
              <a class="cp-osint-link" href="https://ipinfo.io/{{ log.ip_address }}" target="_blank" rel="noopener noreferrer">IPInfo</a>
              <a class="cp-osint-link" href="https://www.shodan.io/host/{{ log.ip_address }}" target="_blank" rel="noopener noreferrer">Shodan</a>
              <a class="cp-osint-link" href="https://viz.greynoise.io/ip/{{ log.ip_address }}" target="_blank" rel="noopener noreferrer">GreyNoise</a>
            </div>
          </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {# ‚ïê‚ïê ANALYSIS ‚ïê‚ïê #}
    <div id="tab-analysis" class="cp-panel">

      <div class="cp-analysis-disclaimer">
        <div class="cp-analysis-disclaimer-icon">‚ö†Ô∏è</div>
        <div>
          <strong>Heuristic analysis ‚Äî not attribution.</strong>
          All observations on this tab are automatically derived from existing log data using lightweight pattern-matching.
          They are approximate, may be inaccurate, and <strong>do not establish identity, physical location, or intent</strong>.
          Shared IPs, VPNs, NAT gateways, link-preview bots, and browser behaviour can all produce misleading signals.
        </div>
      </div>

      {% if logs | length == 0 %}
        <div class="cp-empty">No activity recorded yet.</div>
      {% else %}

        <div class="cp-section-title">Observed Patterns</div>
        <p class="cp-hint">Cross-event observations. All are approximate and low-confidence.</p>

        {% if correlationHints | length == 0 %}
          <div class="cp-analysis-empty">No notable patterns detected in the current log set.</div>
        {% else %}
          <div class="cp-hints-list">
            {% for hint in correlationHints %}
            <div class="cp-hint-card cp-hint-{{ hint.severity }}">
              <div class="cp-hint-severity">{{ hint.severity }}</div>
              <div class="cp-hint-desc">{{ hint.description }}</div>
            </div>
            {% endfor %}
          </div>
        {% endif %}

        <div class="cp-section-title cp-section-title-gap">Event Classification Labels</div>
        <p class="cp-hint">Labels shown on the Timeline tab. Each reflects a single heuristic rule.</p>
        <div class="cp-label-legend">
          {% for key, meta in labelMeta %}
          <div class="cp-label-legend-row">
            <span class="cp-evtlabel cp-evtlabel-{{ key | replace('_', '-') }}">{{ meta.text }}</span>
            <span class="cp-label-legend-desc">
              {% if key == 'first_visit' %}No prior requests from this IP in the log window.
              {% elif key == 'repeat_visit_same_ip' %}This IP has accessed the link at least once before.
              {% elif key == 'repeat_visit_new_ip' %}A new IP, but prior activity from a different IP exists.
              {% elif key == 'rapid_revisit' %}Two or more hits from the same IP within 60 seconds ‚Äî may be a reload, bot, or preview.
              {% elif key == 'expired_link_access' %}Request arrived after the link's expiry timestamp.
              {% elif key == 'burned_link_access' %}Request arrived after the link was burned.
              {% elif key == 'non_browser_user_agent' %}User-Agent does not begin with "Mozilla/" ‚Äî likely a script, CLI tool, or app.
              {% else %}Heuristic label.
              {% endif %}
            </span>
          </div>
          {% endfor %}
        </div>

        <div class="cp-section-title cp-section-title-gap">Narrative Summary</div>
        <p class="cp-hint">Auto-generated plain-English summary. Suitable for reports. Contains no identity claims.</p>
        <div class="cp-narrative-wrap">
          <pre class="cp-narrative" id="narrativeText">{{ narrativeSummary }}</pre>
          <button class="cp-settings-btn cp-narrative-copy-btn" id="copyNarrativeBtn">Copy</button>
        </div>

      {% endif %}
    </div>

    {# ‚ïê‚ïê LOGS ‚ïê‚ïê #}
    <div id="tab-logs" class="cp-panel">
      <div class="cp-section-title">Raw Access Logs</div>
      <div class="cp-table-wrap">
        <table class="cp-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>IP</th>
              <th>Location / TZ</th>
              <th>GPS</th>
              <th>Device</th>
              <th>Language</th>
              <th>Fetch context</th>
              <th>Labels</th>
              <th>Event</th>
              <th>Referer</th>
            </tr>
          </thead>
          <tbody>
            {% if logs | length == 0 %}
              <tr><td colspan="10" class="cp-empty">No logs yet.</td></tr>
            {% else %}
              {% for log in logs %}
              <tr>
                <td class="cp-mono cp-nowrap">{{ log.accessed_at | datetime }}</td>
                <td class="cp-mono"><span class="cp-ip-val" data-ip="{{ log.ip_address or '' }}">{{ log.ip_address or '‚Äî' }}</span></td>
                <td>
                  <div>{{ log.location or '‚Äî' }}</div>
                  {% if log.org %}<div class="cp-sub">{{ log.org }}</div>{% endif %}
                  {% if log.timezone %}<div class="cp-sub cp-tz">{{ log.timezone }}</div>{% endif %}
                </td>
                <td>
                  {% if log.gps_lat %}
                    <a class="cp-gps-link" href="https://maps.google.com/?q={{ log.gps_lat }},{{ log.gps_lng }}" target="_blank" rel="noopener noreferrer">üìç {{ log.gps_lat | round(4) }}, {{ log.gps_lng | round(4) }}</a>
                  {% else %}‚Äî{% endif %}
                </td>
                <td class="cp-mono">{{ log.accept_language or '‚Äî' }}</td>
                <td>
                  {% if log.sec_fetch_site %}
                    <span class="cp-fetch-badge cp-fetch-{{ log.sec_fetch_site }}">{{ log.sec_fetch_site }}</span>
                  {% else %}‚Äî{% endif %}
                </td>
                <td>
                  {% if log._labels %}
                    {% for lbl in log._labels %}
                      <span class="cp-evtlabel cp-evtlabel-{{ lbl | replace('_', '-') }}">{{ lbl | replace('_', ' ') }}</span>
                    {% endfor %}
                  {% else %}‚Äî{% endif %}
                </td>
                <td>
                  {% if log.reveal_succeeded %}
                    <span class="cp-badge cp-badge-red">Revealed</span>
                  {% elif log.reveal_attempted %}
                    <span class="cp-badge cp-badge-yellow">Attempted</span>
                  {% else %}
                    <span class="cp-badge cp-badge-green">View</span>
                  {% endif %}
                </td>
                <td class="cp-trunc">{{ log.referer or '‚Äî' }}</td>
                <td>
                  {% set ua = log.user_agent | parseua %}
                  {% if log.user_agent %}
                    <div class="cp-ua-device">{{ ua.platform }}</div>
                    <div class="cp-sub">{{ ua.browser }}</div>
                  {% else %}‚Äî{% endif %}
                </td>
              </tr>
              {% endfor %}
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>


    {# ‚ïê‚ïê TRACK ‚ïê‚ïê #}
    <div id="tab-track" class="cp-panel">
      <div class="cp-section-title">Location Track</div>
      {% if beacons | length == 0 %}
        <p class="cp-hint">No location beacons received yet. Beacons are sent automatically when a visitor reveals the secret on a mobile device with GPS enabled.</p>
      {% else %}
        <p class="cp-hint">
          <strong>{{ beacons | length }}</strong> location beacon{{ 's' if beacons | length != 1 }} received.
          Live updates every 5 seconds while the page is open.
          <span id="beaconLiveIndicator" class="cp-beacon-live">‚óè Live</span>
        </p>
      {% endif %}
      <div class="cp-table-wrap">
        <table class="cp-table" id="beaconTable">
          <thead>
            <tr>
              <th>Time</th>
              <th>Coordinates</th>
              <th>Accuracy</th>
              <th>IP</th>
              <th>Map</th>
            </tr>
          </thead>
          <tbody id="beaconTbody">
            {% if beacons | length == 0 %}
              <tr id="beaconEmptyRow"><td colspan="5" class="cp-empty">No beacons yet.</td></tr>
            {% else %}
              {% for b in beacons %}
              <tr>
                <td class="cp-mono cp-nowrap">{{ b.beaconed_at | datetime }}</td>
                <td class="cp-mono">{{ b.gps_lat | round(6) }}, {{ b.gps_lng | round(6) }}</td>
                <td class="cp-mono">{% if b.accuracy %}¬±{{ b.accuracy | round(0) }}m{% else %}‚Äî{% endif %}</td>
                <td class="cp-mono"><span class="cp-ip-val" data-ip="{{ b.ip_address or '' }}">{{ b.ip_address or '‚Äî' }}</span></td>
                <td><a class="cp-gps-link" href="https://maps.google.com/?q={{ b.gps_lat }},{{ b.gps_lng }}" target="_blank" rel="noopener noreferrer">üìç Open</a></td>
              </tr>
              {% endfor %}
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    {# ‚ïê‚ïê SETTINGS ‚ïê‚ïê #}
    <div id="tab-settings" class="cp-panel">

      <div class="cp-section-title">Link Label / Note</div>
      <p class="cp-hint">Attach a private note to this link ‚Äî who you sent it to, what platform, any context. Shown in the header bar. Never visible to the recipient.</p>
      <div class="cp-settings-form">
        <div class="cp-settings-row">
          <label class="cp-settings-label" for="noteInput">Note</label>
          <input class="cp-settings-input" type="text" id="noteInput"
            placeholder="e.g. Sent to @scammer123 on Telegram, 2024-06-01"
            value="{{ note or '' }}" maxlength="500" />
        </div>
        <div class="cp-settings-actions">
          <button class="cp-settings-btn" id="saveNoteBtn">Save Note</button>
          <button class="cp-settings-btn cp-settings-btn-danger" id="clearNoteBtn">Clear</button>
        </div>
        <div id="noteStatus" class="cp-settings-status"></div>
      </div>

      <div class="cp-section-title cp-section-title-gap">Webhook Notifications</div>
      <p class="cp-hint">Receive a POST request whenever someone accesses or reveals this secret. Supports Discord webhooks and any generic HTTP endpoint.</p>
      <div class="cp-settings-form">
        <div class="cp-settings-row">
          <label class="cp-settings-label" for="webhookUrlInput">Webhook URL</label>
          <input class="cp-settings-input" type="url" id="webhookUrlInput"
            placeholder="https://discord.com/api/webhooks/‚Ä¶ or https://hooks.example.com/notify"
            value="{{ secret.webhook_url or '' }}" maxlength="512" />
        </div>
        <div class="cp-settings-actions">
          <button class="cp-settings-btn" id="saveWebhookBtn">Save Webhook</button>
          <button class="cp-settings-btn cp-settings-btn-danger" id="clearWebhookBtn">Clear</button>
        </div>
        <div id="webhookStatus" class="cp-settings-status"></div>
      </div>

      <div class="cp-section-title cp-section-title-gap">Test Webhook</div>
      <p class="cp-hint">Send a test ping to confirm your webhook is configured correctly.</p>
      <button class="cp-settings-btn" id="testWebhookBtn">Send Test Ping</button>

      <div class="cp-section-title cp-section-title-gap">Location Requirement</div>
      <p class="cp-hint">When enabled, visitors must grant location access before the secret can be revealed. Those who deny or cannot provide location (e.g. desktop browsers without GPS or WiFi positioning) will see a message instructing them to use a mobile device. Their page visit is still logged.</p>
      <div class="cp-settings-form">
        <div class="cp-settings-toggle-row">
          <span class="cp-settings-label">Require location to reveal</span>
          <label class="cp-toggle" title="Require location to reveal">
            <input type="checkbox" id="requireLocationToggle" {% if requireLocation %}checked{% endif %} />
            <span class="cp-toggle-track"><span class="cp-toggle-thumb"></span></span>
          </label>
        </div>
        <div id="requireLocationStatus" class="cp-settings-status"></div>
      </div>

      <div class="cp-section-title cp-section-title-gap">Manual Revocation</div>
      <p class="cp-hint">Permanently destroy this secret right now, regardless of whether it has been revealed. This cannot be undone.</p>
      {% if burned %}
        <button class="cp-settings-btn cp-settings-btn-burned" disabled>üî• Already Burned</button>
      {% elif expired %}
        <button class="cp-settings-btn" disabled>Link Expired</button>
      {% else %}
        <button class="cp-settings-btn cp-settings-btn-danger" id="burnNowBtn">üî• Burn Now</button>
      {% endif %}

    </div>

  </div>{# /cp-content #}

</body>
</html>
